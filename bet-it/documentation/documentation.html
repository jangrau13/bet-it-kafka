<!DOCTYPE html>
<html>
<head>
    <title>Code Documentation</title>
    <style>
        .section {
            display: none;
            margin-bottom: 20px;
        }
    </style>
    <script>
        function toggleSection(sectionId) {
            var section = document.getElementById(sectionId);
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function handleButtonClick() {
            var playerName = document.getElementById('playerName').value;
            var uuid = document.getElementById('uuid').value;

            if (playerName && playerName.length > 0 && uuid && uuid.length > 0) {
                var socket = new WebSocket('ws://localhost:3001/newUser');
                var userObject = {
                    playerName,
                    playerId: uuid
                };

                socket.addEventListener('open', function() {
                    socket.send(JSON.stringify(userObject));
                    console.log('Player Published', JSON.stringify(userObject));
                });

                socket.addEventListener('error', function(error) {
                    console.error('WebSocket error:', error);
                });
            }
        }

        function openGameURL() {
            window.open('http://localhost:3000', '_blank');
        }

        function postAddMoney() {
            var name = document.getElementById('addMoneyName').value;
            var amount = document.getElementById('addMoneyAmount').value;
            var payload = {
                name,
                amount: parseFloat(amount)
            };

            fetch('http://localhost:8081/demo/add_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
                .then(function(response) {
                    console.log('Money added successfully');
                })
                .catch(function(error) {
                    console.error('Error adding money:', error);
                });
        }

        function postPublishContract() {
            var ratio = document.getElementById('contractRatio').value;
            var contractorName = document.getElementById('contractorName').value;
            var gameId = document.getElementById('contractGameId').value;
            var teamOneWinsContract = document.getElementById('teamOneWinsContract').checked;

            var payload = {
                ratio: parseFloat(ratio),
                contractorName,
                gameId,
                teamOneWinsContract
            };

            fetch('http://localhost:8082/platform/publishContract', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
                .then(function(response) {
                    console.log('Contract published successfully');
                })
                .catch(function(error) {
                    console.error('Error publishing contract:', error);
                });
        }

        function checkContractValidity() {
            var contractId = document.getElementById('contractId').value;

            function pollContractStatus() {
                fetch('http://localhost:8082/platform/contract/' + contractId)
                    .then(function(response) {
                        if (response.status === 200) {
                            return response.json();
                        } else {
                            throw new Error('Contract not valid');
                        }
                    })
                    .then(function(data) {
                        if (data.status === 'ACCEPTED') {
                            var buyerName = document.getElementById('betBuyerName').value;
                            var amountBought = parseFloat(document.getElementById('betAmountBought').value);
                            var betPayload = {
                                buyerName,
                                amountBought,
                                contractId
                            };

                            fetch('http://localhost:8082/platform/publishBet', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(betPayload)
                            })
                                .then(function(response) {
                                    console.log('Bet published successfully');
                                })
                                .catch(function(error) {
                                    console.error('Error publishing bet:', error);
                                });
                        } else {
                            setTimeout(pollContractStatus, 10000);
                        }
                    })
                    .catch(function(error) {
                        console.error('Error checking contract status:', error);
                    });
            }

            pollContractStatus();
        }
    </script>
</head>
<body>
<h1>Code Documentation</h1>

<button onclick="toggleSection('section1')">Section 1: Start and Check Docker Containers</button>
<div id="section1" class="section">
    <h2>Section 1: Start and Check Docker Containers</h2>
    <ol>
        <li>Step 1: Start Docker containers</li>
        <li>Step 2: Check Docker container status</li>
        <li>Step 3: Perform necessary operations</li>
    </ol>
</div>

<button onclick="toggleSection('section2')">Section 2: WebSocket</button>
<div id="section2" class="section">
    <h2>Section 2: WebSocket</h2>
    <label for="playerName">Player Name:</label>
    <input type="text" id="playerName"><br>
    <label for="uuid">Player ID:</label>
    <input type="text" id="uuid"><br>
    <button onclick="handleButtonClick()">Submit</button>
</div>

<button onclick="toggleSection('section3')">Section 3: Start Game</button>
<div id="section3" class="section">
    <h2>Section 3: Start Game</h2>
    <img src="game_image.jpg" alt="Game Image"><br>
    <button onclick="openGameURL()">Click here to start the game</button>
</div>

<button onclick="toggleSection('section4')">Section 4: Add Money</button>
<div id="section4" class="section">
    <h2>Section 4: Add Money</h2>
    <label for="addMoneyName">Name:</label>
    <input type="text" id="addMoneyName"><br>
    <label for="addMoneyAmount">Amount:</label>
    <input type="text" id="addMoneyAmount"><br>
    <button onclick="postAddMoney()">Submit</button>
</div>

<button onclick="toggleSection('section5')">Section 5: Publish Contract</button>
<div id="section5" class="section">
    <h2>Section 5: Publish Contract</h2>
    <label for="contractRatio">Ratio:</label>
    <input type="text" id="contractRatio"><br>
    <label for="contractorName">Contractor Name:</label>
    <input type="text" id="contractorName"><br>
    <label for="contractGameId">Game ID:</label>
    <input type="text" id="contractGameId"><br>
    <label for="teamOneWinsContract">Team One Wins Contract:</label>
    <input type="checkbox" id="teamOneWinsContract"><br>
    <button onclick="postPublishContract()">Submit</button>
</div>

<button onclick="toggleSection('section6')">Section 6: Check Contract Validity</button>
<div id="section6" class="section">
    <h2>Section 6: Check Contract Validity</h2>
    <label for="contractId">Contract ID:</label>
    <input type="text" id="contractId"><br>
    <button onclick="checkContractValidity()">Submit</button>
</div>
</body>
</html>
